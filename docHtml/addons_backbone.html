<h1>backbone Addons</h1>
<p>ACHTUNG: das masterportal wird vom Backbone nach Vue.js migriert. Daher ist es ratsam neue addons in vue.js zu schreiben, um die später notwendige Migrierung zu vermeiden! <a href="">Vue Addons</a></p>
<p>Um eigene Entwicklungen in das MasterPortal zu integrieren existiert ein Mechanismus der es erlaubt, Code von außerhalb des MasterPortal-Repositories in die MasterPortal Sourcen zu integrieren. Siehe auch <strong><a href="setup-dev.html">lokale Entwicklungsumgebung einrichten</a></strong>.</p>
<p>Dadurch werden die Models der externen Sourcen erst ganz zum Schluß initialisiert. Es wird temporär ein Platzhalter-Model in der Model-List angelegt.</p>
<p>Die View-Klasse der externen Sourcen muss das zugehörige Model neu anlegen. Dieses wird dann in der Model-Liste mit dem Platzhalter-Model ausgetauscht.</p>
<p>Das Addon selbst ist identisch wie ein natives Modul zu programmieren (siehe auch <strong><a href="02_tutorial_new_module_scale_switcher.html">Tutorial 01: Ein neues Modul erstellen (Scale Switcher)</a></strong>). Es liegt lediglich außerhalb des Repository und erlaubt so eine getrennte Verwaltung.</p>
<p>Alle Addons liegen in einem Ordner namens “addons” auf Root-Ebene des Masterportals. Beliebig viele dieser Addons lassen sich in einem Portal in der <strong><a href="config.js.html">config.js</a></strong> konfigurieren.</p>
<p>Folgende Struktur ist dabei zu beachten:</p>
<h2>1. Dateistruktur von Addons</h2>
<p>1.1. Jedes <em>Addon</em> liegt in einem eigenen Ordner, welcher so heißt, wie in <strong>addonsConf.json</strong> als key definiert. In diesen Ordnern liegen alle für die jeweiligen <em>Addons</em> benötigten Dateien. Dazu gehören auch die Ordner <strong>doc</strong>, <strong>jsdoc</strong> und <strong>unittests</strong> mit den jeweiligen <strong>.md</strong>, <strong>.js</strong> und <strong>.test.js</strong> Dateien.
Es ist möglich, dass Addons eine eigene <code>package.json</code> Datei besitzen, um weitere Dependencies zu definieren.</p>
<h4>Beispiel entsprechende Ordnerstruktur</h4>
<pre><code>myMasterPortalFolder/
    addons/
        myAddon1/
            view.js
            model.js
            doc/
                config.json.md
            jsdoc/
                events.js
                namespaces.js
            unittests/
                model.test.js
            package.json
            [...]
        myAddon2/
            subFolder/
                init.js
                [...]
            doc/
                beschreibung.md
            jsdoc/
                events.js
                namespaces.js
            unittests/
                addon.test.js
            anotherFile.js
            [...]
    devtools/
    doc/
    [...]
</code></pre>
<p>1.2. Direkt in dem Ordner muss die Konfigurationsdatei <strong>addonsConf.json</strong> liegen. Diese beinhaltet einen JSON bestehend aus den <em>Namen</em> der <em>Addons</em> als Keys und die vom <em>addons/[key]</em> Ordner aus relativen Pfade zu deren <em>Entrypoints</em> als Values. Das nachfolgende Beispiel basiert auf der oben beschriebenen beispielhaften Ordnerstruktur.</p>
<h4>Beispiel <strong>addonsConf.json</strong></h4>
<pre><code class="language-json">{
  &quot;exampleAddon&quot;: &quot;entrypoint.js&quot;,
  &quot;myAddon1&quot;: &quot;view.js&quot;,
  &quot;myAddon2&quot;: &quot;subFolder/init.js&quot;
}
</code></pre>
<p>1.3. Entrypoint des Addons sollte wenn vorhanden der View Constructor sein.</p>
<p>1.4. Es sollen hier ausschließlich nur die Dateien landen, welche zu <em>addons</em> gehören.</p>
<p>1.5 Falls weitere Dependencies die noch nicht im Masterportal vorhanden sind für ein Addon benötigt werden, können diese
über eine eigene <code>package.json</code> installiert werde. Dazu reicht eine minimale <code>package.json</code> aus:</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;exampleAddon&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;I'm an example! I can say hello world.&quot;,
  &quot;dependencies&quot;: {
    &quot;hello&quot;: &quot;^0.3.2&quot;
  }
}
</code></pre>
<p><code>npm install</code> muss für jedes Addon separat ausgeführt werden!</p>
<h2>2. Beispiel-Addon</h2>
<p>Hier legen wir kurz ein Beispiel-Addon an!</p>
<p>2.1. Dateien Erstellen: Das Beispiel-Addon trägt den Namen <em>exampleAddon</em> und seine Enrypoint-Datei heißt <em>entrypoint.js</em>. Daraus ergibt sich eine Dateistruktur wie folgt:</p>
<pre><code>myMasterPortalFolder/
    addons/
        exampleAddon/
            view.js
            model.js
            template.html
    devtools/
    doc/
    [...]
</code></pre>
<p>2.2. Addon-Code schreiben:</p>
<pre><code class="language-js">// myMasterPortalFolder/addons/exampleAddon/model.js
import Tool from &quot;../../modules/core/modelList/tool/model&quot;;

const exampleAddon = Tool.extend({
    defaults: Object.assign({}, Tool.prototype.defaults, {
        glyphicon: &quot;glyphicon-example&quot;,
        renderToWindow: true,
        id: &quot;exampleAddon&quot;,
        name: &quot;Example Tool&quot;
    }),
    initialize: function () {
        this.superInitialize();
    }
});

export default exampleAddon;

</code></pre>
<pre><code class="language-js">// myMasterPortalFolder/addons/exampleAddon/view.js
import ExampleTemplate from &quot;text-loader!./template.html&quot;;
import ExampleModel from &quot;./model&quot;;

const ExampleView = Backbone.View.extend({

    initialize: function ()
     {
        this.model = new ExampleModel();
        this.listenTo(this.model, {
            &quot;change:isActive&quot;: this.render
        });
        if (this.model.get(&quot;isActive&quot;) === true) {
            this.render(this.model, true);
        }
    },
    template: _.template(ExampleTemplate),

    // Konvention: Die Methode fürs zeichnen der View, heißt render.
    render: function (model, value) {
        const attr = model.toJSON();

        if (value) {
            //do something like this
            this.setElement(document.getElementsByClassName(&quot;win-body&quot;)[0]);
            this.$el.html(this.template(attr));
        }
        return this;
    }
});

</code></pre>
<p>2.3. Die Addons-Config-Datei erstellen:</p>
<p>// myMasterPortalFolder/addons/addonsConf.json</p>
<pre><code class="language-json">{
  &quot;exampleAddon&quot;: &quot;view.js&quot;
}
</code></pre>
<p>2.4. Das Beispiel-Addon in der config.js Datei des Portals aktivieren:</p>
<pre><code class="language-js">// myMasterPortalFolder/config.js

const Config = {
    // [...]
    addons: [&quot;exampleAddon&quot;],
    // [...]
};
</code></pre>
<p>2.5. Das Beispiel-Addon als Werkzeug in der config.json definieren, damit es als Menüpunkt erscheint.</p>
<pre><code>// myMasterPortalFolder/config.json
...
    &quot;tools&quot;: {
        &quot;name&quot;: &quot;Werkzeuge&quot;,
        &quot;glyphicon&quot;: &quot;glyphicon-wrench&quot;,
        &quot;children&quot;: {
          &quot;exampleAddon&quot;: {
            &quot;name&quot;: &quot;Beispiel Addon&quot;
          },
</code></pre>
<p>2.5. JSDoc schreiben. Dazu einen im Ordner jsdoc einen Datei namespaces.js anlegen und als memberOf Addons <strong>eintragen</strong>.</p>
<pre><code class="language-js">/**
 * @namespace ExampleAddon
 * @memberof Addons
 */
</code></pre>
<p>2.6. In der model.js muss bei memberOf als Prefix Addons. angegeben werden.</p>
<pre><code class="language-js">/**
* @class ExampleAddonModel
* @extends Tool
* @memberof Addons.ExampleAddon
* @constructs
*/
</code></pre>
