<h1>Vue tutorial: Creating a new <em>ScaleSwitcher</em> tool</h1>
<p>This is a step-by-step instruction for creating a new tool based on <a href="https://vuejs.org/">Vue</a> and <a href="https://vuex.vuejs.org/">Vuex</a>.</p>
<h2>Example requirement</h2>
<p>A tool to control the map scale is needed. Scales are to be chosen from a drop-down menu. The map must react on selections by setting the appropriate zoom level. The tool is also supposed to react on scale changes from other sources (e.g. the zoom buttons) and update the drop-down menu accordingly.</p>
<h2>Creating a new tool</h2>
<p>Switch to the folder <code>src/modules/tools</code> and create a new folder. The folder name should indicate the nature of the tool - e.g. <code>scaleSwitcher</code>. Create folders <code>components</code> and <code>store</code> in that folder, and the required files as shown in the example file tree below.</p>
<blockquote>
<p>üí° Hint: Testing is not part of this guide, but essential to merge a pull request. See our <a href="testing.md">testing documentation</a> for more information.</p>
</blockquote>
<pre><code>src
|-- modules
|   |-- tools
|   |   |-- scaleSwitcher
|   |   |   |-- components
|   |   |	|   |-- ScaleSwitcher.vue
|   |   |   |   |-- ...
|   |   |	|-- store
|   |   |   |   |-- actionsScaleSwitcher.js
|   |   |   |   |-- constantsScaleSwitcher.js (not required in this example)
|   |   |   |   |-- gettersScaleSwitcher.js
|   |   |   |   |-- indexScaleSwitcher.js
|   |   |   |   |-- mutationsScaleSwitcher.js
|   |   |   |   |-- stateScaleSwitcher.js
|   |   |   |
|   |   |	|-- tests
|   |   |	|   |-- end2end
|   |   |   |	|   |-- ScaleSwitcher.e2e.js
|   |   |	|   |-- unit
|   |   |   |	|   |-- components
|   |   |   |   |	|   |-- ScaleSwitcher.spec.js
|   |   |   |	|   |-- store
|   |   |   |   |	|   |-- actionsScaleSwitcher.spec.js
|   |   |   |   |	|   |-- gettersScaleSwitcher.spec.js
|   |   |   |   |	|   |-- mutationsScaleSwitcher.spec.js
</code></pre>
<h2>Creating the ScaleSwitcher.vue</h2>
<p>Open <code>modules/tools/scaleSwitcher/components/ScaleSwitcher.vue</code> and create the Vue component as a <a href="https://vuejs.org/v2/guide/single-file-components.html">single file component</a>. The <code>Tool</code> component should be used here. It encompasses rendering and window (or sidebar) behavior that can be re-used in each tool.</p>
<pre><code class="language-vue">&lt;script&gt;
import ToolTemplate from &quot;../../ToolTemplate.vue&quot;;

export default {
    name: &quot;ScaleSwitcher&quot;,
    components: {
        ToolTemplate
    }
};
&lt;/script&gt;

&lt;template lang=&quot;html&quot;&gt;
&lt;/template&gt;

&lt;style lang=&quot;scss&quot;&gt;
&lt;/style&gt;
</code></pre>
<h2>Register the <em>ScaleSwitcher</em> component</h2>
<p>Open <code>src/modules/tools/stateTools.js</code>, import the <em>ScaleSwitcher</em> and add it to the component map. The <em>ToolManager</em> (<code>src/modules/tools/ToolManager.vue</code>) initializes the component and loads the <em>ScaleSwitcher</em> configuration from the <code>config.json</code>, making it available in its state. The paths <code>configJson.Portalconfig.menu.scaleSwitcher</code> and <code>configJson.Portalconfig.menu.tools.children.scaleSwitcher</code> will be searched for <em>ScaleSwitcher</em> configuration. See the <a href="config.json.md">config.json documentation</a>. The <em>ToolManager</em> is part of the <em>MapRegion‚Äôs</em> template. It will only be created when the <a href="https://vuejs.org/v2/api/#v-if"><em>v-if</em> directive</a> finds the <code>config.json</code> has become part of the global state.</p>
<pre><code class="language-js">import ScaleSwitcher from &quot;./scaleSwitcher/components/ScaleSwitcher.vue&quot;;
// ... import more tools

/**
 * User type definition
 * @typedef {object} ToolsState
 * @property {object} componentMap contains all tool components
 * @property {object[]} configuredTools gets all tools that should be initialized
 */
const state = {
    componentMap: {
        scaleSwitcher: ScaleSwitcher
        // ... more tools
    },
    configuredTools: []
};

export default state;
</code></pre>
<h2>Defining state</h2>
<p><a href="https://vuex.vuejs.org/guide/state.html">Vuex state</a> is defined in the <code>modules/tools/scaleSwitcher/store/stateScaleSwitcher.js</code> file.</p>
<pre><code class="language-js">const state = {
    // mandatory
    active: false,
    id: &quot;scaleSwitcher&quot;,
    // mandatory defaults for config.json parameters
    name: &quot;common:menu.tools.scaleSwitcher&quot;,
    glyphicon: &quot;glyphicon-resize-full&quot;,
    renderToWindow: true,
    resizableWindow: true,
    isVisibleInMenu: true,
    deactivateGFI: false
};

export default state;
</code></pre>
<h2>Defining getters</h2>
<p>Add <a href="https://vuex.vuejs.org/guide/getters.html#getters">VueX getters</a> to the <code>modules/tools/scaleSwitcher/store/gettersScaleSwitcher.js</code>. For simple getters that only retrieve state, the generator function <code>generateSimpleGetters</code> is used.</p>
<pre><code class="language-js">import {generateSimpleGetters} from &quot;../../../../app-store/utils/generators&quot;;
import scaleSwitcherState from &quot;./stateScaleSwitcher&quot;;

const getters = {
    /**
     * Returns an object of simple getters for a state object, where
     * simple means that they will just return an entry for any key.
     * For example, given a state object {key: value}, an object
     * {key: state =&gt; state[key]} will be returned.
     * This is useful to avoid writing basic operations.
     * @param {object} state state to generate getters for
     * @returns {object.&lt;string, function&gt;} object of getters
     */
    ...generateSimpleGetters(scaleSwitcherState)

    // NOTE overwrite (or create additional) getters here if you need special behavior in them
};

export default getters;
</code></pre>
<h2>Defining state mutations</h2>
<p>Add <a href="https://vuex.vuejs.org/guide/mutations.html#mutations">Vuex mutations</a> to the <code>modules/tools/scaleSwitcher/store/mutationsScaleSwitcher.js</code>. For simple mutations that only write state, the generator function <code>generateSimpleMutations</code> is used.</p>
<pre><code class="language-js">import {generateSimpleMutations} from &quot;../../../../app-store/utils/generators&quot;;
import state from &quot;./stateScaleSwitcher&quot;;

const mutations = {
    /**
     * Creates from every state-key a setter.
     * For example, given a state object {key: value}, an object
     * {setKey:   (state, payload) =&gt; *   state[key] = payload * }
     * will be returned.
     */
    ...generateSimpleMutations(state)

     // NOTE overwrite (or create additional) mutations here if you need special behavior in them
};

export default mutations;
</code></pre>
<h2>Defining actions</h2>
<p><a href="https://vuex.vuejs.org/guide/actions.html#actions">Vuex actions</a> can be added to the <code>modules/tools/scaleSwitcher/store/actionsScaleSwitcher.js</code>. The <em>ScaleSwitcher</em> does not need any actions.<code>setToolActiveByConfig</code> is controlled globally by the <em>ToolManager</em>.</p>
<ul>
<li>The action <code>setToolActiveByConfig</code> sets a tool‚Äôs value ‚Äúactive‚Äù to <code>true</code>, which results in rendering the tool. See property <code>active</code> in the <em>Tool.vue</em>.</li>
</ul>
<pre><code class="language-js">const actions = {
    // NOTE write actions here if you need them
};

export default actions;
</code></pre>
<h3>Setting up the store/index file</h3>
<p>Open the file <code>src/modules/tools/scaleSwitcher/store/indexScaleSwitcher.js</code>. Default export the previously created state, getters, mutations, and actions as an object. This represents a Vuex store, and is pluggable to another Vuex store as a module.</p>
<blockquote>
<p>üí° The <code>namespaced: true</code> has to be set by convention. This prevents naming conflicts stores with modules.</p>
</blockquote>
<pre><code class="language-js">import mutations from &quot;./mutationsScaleSwitcher&quot;;
import actions from &quot;./actionsScaleSwitcher&quot;;
import getters from &quot;./gettersScaleSwitcher&quot;;
import state from &quot;./stateScaleSwitcher&quot;;

export default {
    namespaced: true,
    state,
    mutations,
    actions,
    getters
};
</code></pre>
<h2>Add the Vuex module to the global store</h2>
<p>Open <code>src/modules/tools/indexTools.js</code>, import <code>src/modules/tools/scaleSwitcher/store/indexScaleSwitcher.js</code>, and register it to the Vuex tool store as a <em>module</em>.</p>
<pre><code class="language-js">import state from &quot;./stateTools&quot;;
import getters from &quot;./gettersTools&quot;;
import mutations from &quot;./mutationsTools&quot;;
import actions from &quot;./actionsTools&quot;;
import ScaleSwitcher from &quot;./scale/store/indexScaleSwitcher&quot;;
// ... import further tools

export default {
    namespaced: true,
    modules: {
        ScaleSwitcher
        // ... further tools
    },
    state,
    getters,
    mutations,
    actions
};
</code></pre>
<h2>Use getters as computed properties in the ScaleSwitcher.vue</h2>
<p>Import the vuex helper function <code>mapGetters</code> in the <code>modules/tools/scaleSwitcher/components/ScaleSwitcher.vue</code>, and the <em>ScaleSwitchers</em> getters. All getter keys of the <em>ScaleSwitcher</em> and the Vuex <em>Map</em> module getters <code>scale</code> and <code>scales</code> are added. For <code>scale</code>, a setter is provided. Using <code>scale</code>, the current <em>Map</em> scale can be retrieved, and <code>scales</code> represents all available <em>Map</em> scales.</p>
<pre><code class="language-js">import ToolTemplate from &quot;../../ToolTemplate.vue&quot;;
import {mapGetters} from &quot;vuex&quot;;
import getters from &quot;../store/gettersScaleSwitcher&quot;;

    ...
    computed: {
            ...mapGetters(&quot;Tools/ScaleSwitcher&quot;, Object.keys(getters)),
            ...mapGetters(&quot;Map&quot;, [&quot;scales&quot;]),
            scale: {
                get () {
                    return this.$store.state.Map.scale;
                },
                set (value) {
                    this.$store.commit(&quot;Map/setScale&quot;, value);
                }
            }
        },
    ...
</code></pre>
<h2>Use mutations as methods in the ScaleSwitcher.vue</h2>
<p>Import the vuex helper function <code>mapMutations</code> in the <code>modules/tools/scaleSwitcher/components/ScaleSwitcher.vue</code>, and the <em>ScaleSwitcher</em> mutations. All mutation keys of the <em>ScaleSwitcher</em> are added.</p>
<pre><code class="language-js">import ToolTemplate from &quot;../../ToolTemplate.vue&quot;;
import {mapGetters, mapMutations} from &quot;vuex&quot;;
import getters from &quot;../store/gettersScaleSwitcher&quot;;
import mutations from &quot;../store/mutationsScaleSwitcher&quot;;

    ...
    methods: {
        ...mapMutations(&quot;Tools/ScaleSwitcher&quot;, Object.keys(mutations)),
    },
    ...
</code></pre>
<h2>Closing the <em>ScaleSwitcher</em> window</h2>
<p>Open the <code>modules/tools/scaleSwitcher/components/ScaleSwitcher.vue</code> and implement the lifecycle hook <code>created</code>. In this function, a <code>close</code> listener is added, listening to the <em>Tool</em> event <code>close</code> fired with the <code>emit</code> function, and calls its local method <code>close</code> as a reaction. This method sets the state variable <code>active</code> to <code>false</code>.</p>
<blockquote>
<p>‚ö†Ô∏è WARNING: Since the Masterportal core is currently still implemented in Backbone, the associated Backbone model must be deactivated as a final step.</p>
</blockquote>
<pre><code class="language-js">    ...
    created () {
        this.$on(&quot;close&quot;, this.close);
    },
    ...
    methods: {
        ...
        close () {
                this.setActive(false);

                // set the backbone model to active=false in modellist for changing css class in menu (menu/desktop/tool/view.toggleIsActiveClass)
                const model = Radio.request(&quot;ModelList&quot;, &quot;getModelByAttributes&quot;, {id: this.$store.state.Tools.ScaleSwitcher.id});

                if (model) {
                    model.set(&quot;isActive&quot;, false);
                }
        }
    },
    ...
</code></pre>
<h2>Writing the ScaleSwitcher.vue template</h2>
<p>In <code>modules/tools/scaleSwitcher/components/ScaleSwitcher.vue</code>, the template is yet to be defined. The <em>ScaleSwitchers</em> HTML is generated from this, and belongs to a nested template child of the <em>Tool</em>.</p>
<ul>
<li>The nested template defines the <em>ScaleSwitcher</em> contents to the <em>Tool‚Äôs</em> v-slot toolBody: <code>&lt;template v-slot:toolBody&gt; </code></li>
<li>The required parameters are forwarded to the tool</li>
<li>The outher div needs a unique <code>id</code> and the <a href="https://vuejs.org/v2/api/#v-if"><em>v-if</em> directive</a> <code>&quot;active&quot;</code>. This ensures the contents are only rendered when <code>active</code> is <code>true</code>.</li>
<li>In a <a href="https://vuejs.org/v2/api/#v-for"><em>v-for</em> directive</a> the <code>option</code> elements are created from the available <code>scales</code>.</li>
</ul>
<pre><code class="language-html">&lt;template lang=&quot;html&quot;&gt;
    &lt;ToolTemplate
        :title=&quot;$t(name)&quot;
        :icon=&quot;glyphicon&quot;
        :active=&quot;active&quot;
        :render-to-window=&quot;renderToWindow&quot;
        :resizable-window=&quot;resizableWindow&quot;
        :deactivateGFI=&quot;deactivateGFI&quot;
    &gt;
        &lt;template v-slot:toolBody&gt;
            &lt;div id=&quot;scale-switcher&quot; v-if=&quot;active&quot;&gt;
                &lt;label
                    for=&quot;scale-switcher-select&quot;
                    class=&quot;col-md-5 col-sm-5 control-label&quot;
                &gt;
                    Scale
                &lt;/label&gt;
                &lt;div class=&quot;col-md-7 col-sm-7&quot;&gt;
                    &lt;select
                        id=&quot;scale-switcher-select&quot;
                        v-model=&quot;scale&quot;
                        class=&quot;font-arial form-control input-sm pull-left&quot;
                    &gt;
                        &lt;option
                            v-for=&quot;(scaleValue, i) in scales&quot;
                            :key=&quot;i&quot;
                            :value=&quot;scaleValue&quot;
                        &gt;
                            1:{{ scaleValue }}
                        &lt;/option&gt;
                    &lt;/select&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/template&gt;
    &lt;/ToolTemplate&gt;
&lt;/template&gt;
</code></pre>
<h2>Defining <em>scss</em> styling rules</h2>
<p>Within the <code>modules/tools/scaleSwitcher/components/ScaleSwitcher.vue*</code>, styles can be added to the <code>style</code> tag. Note that the <code>css/variables.scss</code> offers a set of predefined colors and values for usage in all components.</p>
<pre><code class="language-scss">&lt;style lang=&quot;scss&quot; scoped&gt;
    @import &quot;~variables&quot;;

    label {
        margin-top: 7px;
    }

    #scale-switcher-select {
        border: 2px solid $secondary;
    }
&lt;/style&gt;
</code></pre>
<h2>Reacting to scale changes</h2>
<p>Within the <code>modules/tools/scaleSwitcher/components/ScaleSwitcher.vue</code> template, add a change listener to the <code>select</code> element calling the <code>setResolutionByIndex</code> method.</p>
<pre><code class="language-html">&lt;select
    id=&quot;scale-switcher-select&quot;
    class=&quot;font-arial form-control input-sm pull-left&quot;
    @change=&quot;setResolutionByIndex($event.target.selectedIndex)&quot;
&gt;
</code></pre>
<p>The <em>Map</em> offers a <a href="https://vuex.vuejs.org/guide/getters.html#getters">Vuex action</a> <code>setResolutionByIndex</code>. Import the Vuex helper function <code>mapActions</code> for easy access.
Calling it will set the map‚Äôs resolution to a new value.</p>
<pre><code class="language-js">import {mapGetters, mapActions, mapMutations} from &quot;vuex&quot;;

    ...
    methods: {
        ...mapActions(&quot;Map&quot;, [&quot;setResolutionByIndex&quot;]),
        ...
    }
    ...
</code></pre>
<h2>Internationalization</h2>
<p>Labels should be available in multiple languages. For this, create localization keys in the translation files <code>locales/[de/en]/common.json</code>. Read the <a href="languages.md">internationalization documentation</a> for more details.</p>
<pre><code class="language-js">&quot;modules&quot;: {
    &quot;tools&quot;: {
        &quot;scaleSwitcher&quot;: {
            &quot;label&quot;: &quot;Scales&quot;
        },
        ... // further translations
</code></pre>
<p>The value can be accessed directly in the template by using the globally available <code>$t</code> function.</p>
<pre><code class="language-html">&lt;label
    for=&quot;scale-switcher-select&quot;
    class=&quot;col-md-5 col-sm-5 control-label&quot;
&gt;
    {{ $t(&quot;modules.tools.scaleSwitcher.label&quot;) }}
&lt;/label&gt;
</code></pre>
<h2>config.json tool configuration</h2>
<p>To make the tool usable within a portal, it has to be configured in the portal‚Äôs <code>config.json</code>.</p>
<pre><code class="language-json">{
    &quot;tools&quot;: {
        &quot;name&quot;: &quot;Tools&quot;,
        &quot;glyphicon&quot;: &quot;glyphicon-wrench&quot;,
        &quot;children&quot;: {
            &quot;scaleSwitcher&quot;: {
                &quot;name&quot;: &quot;translate#common:menu.tools.scaleSwitcher&quot;,
                &quot;glyphicon&quot;: &quot;glyphicon-resize-small&quot;,
                &quot;renderToWindow&quot;: true
            }
        }
    }
}
</code></pre>
<p>The tool‚Äôs name translation has to be added to the <code>locales/[de/en]/common.json</code> files.</p>
<pre><code class="language-json">{
    &quot;common&quot;: {
        &quot;menu&quot;: {
            &quot;tools&quot;: {
                &quot;scaleSwitcher&quot;: &quot;Switch scale&quot;
            }
        }
    }
}
</code></pre>
